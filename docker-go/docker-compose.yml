version: '3.9'

services:
  go:
    build:
      context: .
      dockerfile: ./infra/docker/go/Dockerfile
    container_name: ${PROJECT_NAME:-docker-go}
    hostname: ${PROJECT_NAME:-docker-go}
    working_dir: /go/src/app
    tty: true
    restart: unless-stopped
    env_file:
      - .env
    ports:
      - target: 8080
        published: ${APP_PORT:-8080}
        protocol: tcp
        mode: host
    volumes:
      - type: bind
        source: ./src
        target: /go/src/app
    environment:
      - TZ=${TZ-Asia/Tokyo}
      - GO_ENV=${GO_ENV-development}
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000"]
      interval: 30s
      timeout: 10s
      retries: 3
